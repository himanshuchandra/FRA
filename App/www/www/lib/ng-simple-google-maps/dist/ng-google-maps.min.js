angular.module("ngGoogleMaps",[]),function(n){n.directive("ngGoogleMap",function(){return{restrict:"E",replace:!0,template:"<div></div>",scope:{options:"=",markers:"=",route:"=",info:"=",resize:"="},link:function(n,o,e){function t(n,o,e){return o.center=new google.maps.LatLng(o.center.lat,o.center.lng),o.zoomControl=!0,o.zoomControlOptions={position:google.maps.ControlPosition.TOP_RIGHT},e(new google.maps.Map(document.getElementById(n),o))}function i(n){return new google.maps.Marker({position:n.position,title:n.title?n.title:"",animation:google.maps.Animation.DROP,icon:n.icon?n.icon:e.markerIcon?e.markerIcon:""})}function r(n){return new google.maps.Marker(n)}function a(o){k.map(function(n){l(n)}),k=[],w=new google.maps.LatLngBounds,o.map(function(n){var o=i(n);n.click&&"function"==typeof n.click&&c(o,n.click),n.mouseover&&"function"==typeof n.mouseover&&s(o,n.mouseover),w.extend(o.position),k.push(o)}),window.setTimeout(function(){k.map(function(o){n.$apply(function(){o.setMap(m)})})},1e3),k.length>0&&(1==k.length?(m.setCenter(k[0].position),m.setZoom(10)):m.fitBounds(w))}function l(n){n.setMap(null)}function c(n,o){n.addListener("click",o)}function s(n,o){n.addListener("mouseover",o)}function g(n){n&&n.length>=2?f.route({origin:new google.maps.LatLng(n[0].lat,n[0].lng),destination:new google.maps.LatLng(n[n.length-1].lat,n[n.length-1].lng),waypoints:v,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.DRIVING},function(n,o){o===google.maps.DirectionsStatus.OK&&(d.setMap(m),d.setDirections(n))}):d.setMap(null)}function u(n){window.setTimeout(function(){return google.maps.event.trigger(m,"resize"),n()},100)}function p(n){m.setCenter(n)}var m,f,d,w,k=[],v=[],M=null;n.$watchCollection("route",function(n,o){g(n)}),n.$watchCollection("markers",function(n,o){a(n)}),n.$watchCollection("resize",function(n,o){n&&u(function(){p(m.getCenter())})}),n.$watchCollection("info",function(n,o){n&&(M&&M.close(),M=new google.maps.InfoWindow(n),n.index&&k.length>0?M.open(m,k[n.index]):n.marker?M.open(m,r(marker)):M.open(m))}),t(e.id,n.options,function(o){m=o,a(n.markers),f=new google.maps.DirectionsService,d=new google.maps.DirectionsRenderer})}}})}(angular.module("ngGoogleMaps"));